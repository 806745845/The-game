<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>HTML5学堂 - H5course</title>
	<meta name="viewport" content="width=device-width,user-scalable=no">
	<link rel="stylesheet" href="../css/reset.css">
	<style>
		.wrap {
			width: 300px;
			height: 300px;
			border: 1px solid #ccc;
			margin: 20px auto 0;
		}
		.wrap div {
			float: left;
			width: 148px;
			height: 148px;
			border: 1px solid orange;
		}
	</style>
</head>
<body>
	<button id="btn">点击</button>
	<button id="btnStop">暂停</button>
	<div class="wrap" id="box">
		<div></div>
		<div></div>
		<div></div>
		<div></div>
	</div>
	<script>
		var col = document.getElementById('box').children;
		var btnStop = document.getElementById('btnStop');
		var len = col.length;
		var timer2 = null;
		var timer = null;
		var timer3 = null;
		// var sopt = true;

		// 初始状态
		function initial() {
			for (var i = 0; i < len; i++) {
				col[i].style.background = 'rgb(255, 0, 0)';
				col[i].onclick = null;
			}
		}initial();

// 点击倒计时
		var btn = document.getElementById('btn');
		var t = 0;//时间
		var step = 1;//速度
		btn.onclick = function() {
			timer = setInterval(ran, 5000);
			ran();
			t = 300;
			function move() {
				t -= step;
				console.log(t);
				if (t <= 0) {
					clearInterval(timer3);
					clearInterval(timer);
					clearTimeout(timer2);
					alert('游戏结束');
					initial();
				}
			}
			
			timer3 = setInterval(move, 1000);
		}


		var result = 0;
		var bowlings = true;
		// 点击状态四种颜色有其中一种改变颜色
			function ran() {
				for (var i = 0; i < len; i++) {
					col[i].style.background = 'rgb(255, 0, 0)';
					col[i].onclick = null;
				}
					var num = Math.floor(Math.random() * 4);
					col[num].style.background = 'rgba(255, 0, 0, 0.6)';
				// 关卡设置
					col[num].onclick = function() {
					if (bowlings) {
						result += 1;
					}
						console.log(result);
						//过此关需要的个数；
						if (result >= 2) {	
							alert('成功进入下一关');
							result = 0;
							clearInterval(timer3);
							clearInterval(timer);
							clearTimeout(timer2);
						}
						clickFun();
					} 
			};


		//点击成功后隔一秒跳出来下一个
			function clickFun() {
				clearInterval(timer);
				for (var i = 0; i < len; i++) {
					col[i].style.background = 'rgb(255, 0, 0)';
					col[i].onclick = null;
				}
				timer2 = setTimeout(function(){
					ran();
					timer = setInterval(ran, 5000);
				}, 1000)
			}

		//暂停
		btnStop.onclick = function() {
			bowlings = false;
			// clickFun = null;
			// col[num].onclick = null;
			// function ran() {
			// 	col[num].onclick = null;
			// }
			clearInterval(timer3);
			clearInterval(timer);
			clearTimeout(timer2);
			
		}
	</script>
</body>
</html>